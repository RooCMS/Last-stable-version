(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","diff_match_patch"],a)}else{a(CodeMirror)}}})(function(y){var o=y.Pos;var L="http://www.w3.org/2000/svg";function j(ac,ad){this.mv=ac;this.type=ad;this.classes=ad=="left"?{chunk:"CodeMirror-merge-l-chunk",start:"CodeMirror-merge-l-chunk-start",end:"CodeMirror-merge-l-chunk-end",insert:"CodeMirror-merge-l-inserted",del:"CodeMirror-merge-l-deleted",connect:"CodeMirror-merge-l-connect"}:{chunk:"CodeMirror-merge-r-chunk",start:"CodeMirror-merge-r-chunk-start",end:"CodeMirror-merge-r-chunk-end",insert:"CodeMirror-merge-r-inserted",del:"CodeMirror-merge-r-deleted",connect:"CodeMirror-merge-r-connect"}}j.prototype={constructor:j,init:function(af,ae,ad){this.edit=this.mv.edit;(this.edit.state.diffViews||(this.edit.state.diffViews=[])).push(this);this.orig=y(af,p({value:ae,readOnly:!this.mv.options.allowEditingOriginals},p(ad)));if(this.mv.options.connect=="align"){if(!this.edit.state.trackAlignable){this.edit.state.trackAlignable=new C(this.edit)}this.orig.state.trackAlignable=new C(this.orig)}this.orig.state.diffViews=[this];var ac=ad.chunkClassLocation||"background";if(Object.prototype.toString.call(ac)!="[object Array]"){ac=[ac]}this.classes.classLocation=ac;this.diff=b(G(ae),G(ad.value));this.chunks=s(this.diff);this.diffOutOfDate=this.dealigned=false;this.needsScrollSync=null;this.showDifferences=ad.showDifferences!==false},registerEvents:function(){this.forceUpdate=U(this);v(this,true,false);e(this)},setShowDifferences:function(ac){ac=ac!==false;if(ac!=this.showDifferences){this.showDifferences=ac;this.forceUpdate("full")}}};function M(ac){if(ac.diffOutOfDate){ac.diff=b(ac.orig.getValue(),ac.edit.getValue());ac.chunks=s(ac.diff);ac.diffOutOfDate=false;y.signal(ac.edit,"updateDiff",ac.diff)}}var ab=false;function U(ad){var ak={from:0,to:0,marked:[]};var ai={from:0,to:0,marked:[]};var ac,al=false;function af(am){ab=true;al=false;if(am=="full"){if(ad.svg){K(ad.svg)}if(ad.copyButtons){K(ad.copyButtons)}Z(ad.edit,ak.marked,ad.classes);Z(ad.orig,ai.marked,ad.classes);ak.from=ak.to=ai.from=ai.to=0}M(ad);if(ad.showDifferences){u(ad.edit,ad.diff,ak,DIFF_INSERT,ad.classes);u(ad.orig,ad.diff,ai,DIFF_DELETE,ad.classes)}if(ad.mv.options.connect=="align"){f(ad)}r(ad);if(ad.needsScrollSync!=null){D(ad,ad.needsScrollSync)}ab=false}function ag(am){if(ab){return}ad.dealigned=true;aj(am)}function aj(am){if(ab||al){return}clearTimeout(ac);if(am===true){al=true}ac=setTimeout(af,am===true?20:250)}function ah(am,an){if(!ad.diffOutOfDate){ad.diffOutOfDate=true;ak.from=ak.to=ai.from=ai.to=0}ag(an.text.length-1!=an.to.line-an.from.line)}function ae(){ad.diffOutOfDate=true;af("full")}ad.edit.on("change",ah);ad.orig.on("change",ah);ad.edit.on("swapDoc",ae);ad.orig.on("swapDoc",ae);if(ad.mv.options.connect=="align"){y.on(ad.edit.state.trackAlignable,"realign",ag);y.on(ad.orig.state.trackAlignable,"realign",ag)}ad.edit.on("viewportChange",function(){aj(false)});ad.orig.on("viewportChange",function(){aj(false)});af();return af}function e(ac){ac.edit.on("scroll",function(){D(ac,true)&&r(ac)});ac.orig.on("scroll",function(){D(ac,false)&&r(ac)})}function D(ao,af){if(ao.diffOutOfDate){if(ao.lockScroll&&ao.needsScrollSync==null){ao.needsScrollSync=af}return false}ao.needsScrollSync=null;if(!ao.lockScroll){return true}var ah,aj,ae=+new Date;if(af){ah=ao.edit;aj=ao.orig}else{ah=ao.orig;aj=ao.edit}if(ah.state.scrollSetBy==ao&&(ah.state.scrollSetAt||0)+250>ae){return false}var ac=ah.getScrollInfo();if(ao.mv.options.connect=="align"){ag=ac.top}else{var ad=0.5*ac.clientHeight,am=ac.top+ad;var at=ah.lineAtHeight(am,"local");var aq=aa(ao.chunks,at,af);var au=S(ah,af?aq.edit:aq.orig);var al=S(aj,af?aq.orig:aq.edit);var ak=(am-au.top)/(au.bot-au.top);var ag=(al.top-ad)+ak*(al.bot-al.top);var ai,an;if(ag>ac.top&&(an=ac.top/ad)<1){ag=ag*an+ac.top*(1-an)}else{if((ai=ac.height-ac.clientHeight-ac.top)<ad){var ar=aj.getScrollInfo();var ap=ar.height-ar.clientHeight-ag;if(ap>ai&&(an=ai/ad)<1){ag=ag*an+(ar.height-ar.clientHeight-ai)*(1-an)}}}}aj.scrollTo(ac.left,ag);aj.state.scrollSetAt=ae;aj.state.scrollSetBy=ao;return true}function S(ac,ad){var ae=ad.after;if(ae==null){ae=ac.lastLine()+1}return{top:ac.heightAtLine(ad.before||0,"local"),bot:ac.heightAtLine(ae,"local")}}function v(ac,ae,ad){ac.lockScroll=ae;if(ae&&ad!=false){D(ac,DIFF_INSERT)&&r(ac)}ac.lockButton.innerHTML=ae?"\u21db\u21da":"\u21db&nbsp;&nbsp;\u21da"}function q(af,ac,ae){var ag=ae.classLocation;for(var ad=0;ad<ag.length;ad++){af.removeLineClass(ac,ag[ad],ae.chunk);af.removeLineClass(ac,ag[ad],ae.start);af.removeLineClass(ac,ag[ad],ae.end)}}function Z(af,ac,ae){for(var ad=0;ad<ac.length;++ad){var ag=ac[ad];if(ag instanceof y.TextMarker){ag.clear()}else{if(ag.parent){q(af,ag,ae)}}}ac.length=0}function u(af,ah,ag,ae,ad){var ac=af.getViewport();af.operation(function(){if(ag.from==ag.to||ac.from-ag.to>20||ag.from-ac.to>20){Z(af,ag.marked,ad);d(af,ah,ae,ag.marked,ac.from,ac.to,ad);ag.from=ac.from;ag.to=ac.to}else{if(ac.from<ag.from){d(af,ah,ae,ag.marked,ac.from,ag.from,ad);ag.from=ac.from}if(ac.to>ag.to){d(af,ah,ae,ag.marked,ag.to,ac.to,ad);ag.to=ac.to}}})}function A(aj,ad,ae,ag,ac,af){var ai=ae.classLocation,ak=aj.getLineHandle(ad);for(var ah=0;ah<ai.length;ah++){if(ag){aj.addLineClass(ak,ai[ah],ae.chunk)}if(ac){aj.addLineClass(ak,ai[ah],ae.start)}if(af){aj.addLineClass(ak,ai[ah],ae.end)}}return ak}function d(aj,an,ai,au,at,ae,aw){var al=o(0,0);var ap=o(at,0),ao=aj.clipPos(o(ae-1));var ac=ai==DIFF_DELETE?aw.del:aw.insert;function am(aE,aA){var aD=Math.max(at,aE),aB=Math.min(ae,aA);for(var aC=aD;aC<aB;++aC){au.push(A(aj,aC,aw,true,aC==aE,aC==aA-1))}if(aE==aA&&aD==aA&&aB==aA){if(aD){au.push(A(aj,aD-1,aw,false,false,true))}else{au.push(A(aj,aD,aw,false,true,false))}}}var az=0,ak=false;for(var av=0;av<an.length;++av){var ar=an[av],ad=ar[0],aq=ar[1];if(ad==DIFF_EQUAL){var ah=al.line+(N(an,av)?0:1);I(al,aq);var ag=al.line+(Q(an,av)?1:0);if(ag>ah){if(ak){am(az,ah);ak=false}az=ag}}else{ak=true;if(ad==ai){var af=I(al,aq,true);var ay=O(ap,al),ax=l(ao,af);if(!T(ay,ax)){au.push(aj.markText(ay,ax,{className:ac}))}al=af}}}if(ak){am(az,al.line+1)}}function r(ad){if(!ad.showDifferences){return}if(ad.svg){K(ad.svg);var ak=ad.gap.offsetWidth;i(ad.svg,"width",ak,"height",ad.gap.offsetHeight)}if(ad.copyButtons){K(ad.copyButtons)}var ai=ad.edit.getViewport(),aj=ad.orig.getViewport();var ah=ad.mv.wrap.getBoundingClientRect().top;var af=ah-ad.edit.getScrollerElement().getBoundingClientRect().top+ad.edit.getScrollInfo().top;var ae=ah-ad.orig.getScrollerElement().getBoundingClientRect().top+ad.orig.getScrollInfo().top;for(var ag=0;ag<ad.chunks.length;ag++){var ac=ad.chunks[ag];if(ac.editFrom<=ai.to&&ac.editTo>=ai.from&&ac.origFrom<=aj.to&&ac.origTo>=aj.from){a(ad,ac,ae,af,ak)}}}function E(ah,ag){var af=0,ae=0;for(var ad=0;ad<ag.length;ad++){var ac=ag[ad];if(ac.editTo>ah&&ac.editFrom<=ah){return null}if(ac.editFrom>ah){break}af=ac.editTo;ae=ac.origTo}return ae+(ah-af)}function V(al,ai,af){var ak=al.state.trackAlignable;var ad=al.firstLine(),ah=0;var am=[];for(var ag=0;;ag++){var aj=ai[ag];var ac=!aj?al.lastLine()+1:af?aj.origFrom:aj.editFrom;for(;ah<ak.alignable.length;ah+=2){var ae=ak.alignable[ah]+1;if(ae<=ad){continue}if(ae<ac){am.push(ae)}else{break}}if(!aj){break}am.push(ad=af?aj.origTo:aj.editTo)}return am}function m(ap,am,ak,ac){var ad=0,ai=0,af=0,ao=0;for(;;ad++){var ae=ap[ad],ag=am[ai];if(!ae&&ag==null){break}var ah=ae?ae[0]:1000000000,al=ag==null?1000000000:ag;while(af<ak.length){var an=ak[af];if(an.editTo>ah){break}ao+=(an.origTo-an.origFrom)-(an.editTo-an.editFrom);af++}if(ah==al-ao){ae[ac]=al;ai++}else{if(ah<al-ao){ae[ac]=ah+ao}else{var aj=[al-ao,null,null];aj[ac]=al;ap.splice(ad,0,aj);ai++}}}}function n(ah,ad){var af=V(ah.edit,ah.chunks,false),ac=[];if(ad){for(var ag=0,ae=0;ag<ad.chunks.length;ag++){var ai=ad.chunks[ag].editTo;while(ae<af.length&&af[ae]<ai){ae++}if(ae==af.length||af[ae]!=ai){af.splice(ae++,0,ai)}}}for(var ag=0;ag<af.length;ag++){ac.push([af[ag],null,null])}m(ac,V(ah.orig,ah.chunks,true),ah.chunks,1);if(ad){m(ac,V(ad.orig,ad.chunks,true),ad.chunks,2)}return ac}function f(ac,ad){if(!ac.dealigned&&!ad){return}if(!ac.orig.curOp){return ac.orig.operation(function(){f(ac,ad)})}ac.dealigned=false;var ag=ac.mv.left==ac?ac.mv.right:ac.mv.left;if(ag){M(ag);ag.dealigned=false}var af=n(ac,ag);var ak=ac.mv.aligners;for(var ae=0;ae<ak.length;ae++){ak[ae].clear()}ak.length=0;var aj=[ac.edit,ac.orig],ai=[];if(ag){aj.push(ag.orig)}for(var ae=0;ae<aj.length;ae++){ai.push(aj[ae].getScrollInfo().top)}for(var ah=0;ah<af.length;ah++){P(aj,af[ah],ak)}for(var ae=0;ae<aj.length;ae++){aj[ae].scrollTo(null,ai[ae])}}function P(ac,ad,ag){var af=0,aj=[];for(var ae=0;ae<ac.length;ae++){if(ad[ae]!=null){var ai=ac[ae].heightAtLine(ad[ae],"local");aj[ae]=ai;af=Math.max(af,ai)}}for(var ae=0;ae<ac.length;ae++){if(ad[ae]!=null){var ah=af-aj[ae];if(ah>1){ag.push(H(ac[ae],ad[ae],ah))}}}}function H(ad,ae,ag){var ac=true;if(ae>ad.lastLine()){ae--;ac=false}var af=document.createElement("div");af.className="CodeMirror-merge-spacer";af.style.height=ag+"px";af.style.minWidth="1px";return ad.addLineWidget(ae,af,{height:ag,above:ac,mergeSpacer:true})}function a(ak,aj,ao,ad,ai){var af=ak.type=="left";var am=ak.orig.heightAtLine(aj.origFrom,"local",true)-ao;if(ak.svg){var ac=am;var ah=ak.edit.heightAtLine(aj.editFrom,"local",true)-ad;if(af){var au=ac;ac=ah;ah=au}var ag=ak.orig.heightAtLine(aj.origTo,"local",true)-ao;var ap=ak.edit.heightAtLine(aj.editTo,"local",true)-ad;if(af){var au=ag;ag=ap;ap=au}var an=" C "+ai/2+" "+ah+" "+ai/2+" "+ac+" "+(ai+2)+" "+ac;var al=" C "+ai/2+" "+ag+" "+ai/2+" "+ap+" -1 "+ap;i(ak.svg.appendChild(document.createElementNS(L,"path")),"d","M -1 "+ah+an+" L "+(ai+2)+" "+ag+al+" z","class",ak.classes.connect)}if(ak.copyButtons){var ar=ak.copyButtons.appendChild(R("div",ak.type=="left"?"\u21dd":"\u21dc","CodeMirror-merge-copy"));var aq=ak.mv.options.allowEditingOriginals;ar.title=aq?"Push to left":"Revert chunk";ar.chunk=aj;ar.style.top=(aj.origTo>aj.origFrom?am:ak.edit.heightAtLine(aj.editFrom,"local")-ad)+"px";if(aq){var at=ak.edit.heightAtLine(aj.editFrom,"local")-ad;var ae=ak.copyButtons.appendChild(R("div",ak.type=="right"?"\u21dd":"\u21dc","CodeMirror-merge-copy-reverse"));ae.title="Push to right";ae.chunk={editFrom:aj.origFrom,editTo:aj.origTo,origFrom:aj.editFrom,origTo:aj.editTo};ae.style.top=at+"px";ak.type=="right"?ae.style.left="2px":ae.style.right="2px"}}}function t(ac,ah,ai,ag){if(ac.diffOutOfDate){return}var aj=ag.origTo>ai.lastLine()?o(ag.origFrom-1):o(ag.origFrom,0);var af=o(ag.origTo,0);var ad=ag.editTo>ah.lastLine()?o(ag.editFrom-1):o(ag.editFrom,0);var ae=o(ag.editTo,0);var ak=ac.mv.options.revertChunk;if(ak){ak(ac.mv,ai,aj,af,ah,ad,ae)}else{ah.replaceRange(ai.getRange(aj,af),ad,ae)}}var x=y.MergeView=function(ah,ar){if(!(this instanceof x)){return new x(ah,ar)}this.options=ar;var ak=ar.origLeft,ai=ar.origRight==null?ar.orig:ar.origRight;var an=ak!=null,at=ai!=null;var al=1+(an?1:0)+(at?1:0);var ae=[],ag=this.left=null,ao=this.right=null;var aq=this;if(an){ag=this.left=new j(this,"left");var ad=R("div",null,"CodeMirror-merge-pane CodeMirror-merge-left");ae.push(ad);ae.push(F(ag))}var aj=R("div",null,"CodeMirror-merge-pane CodeMirror-merge-editor");ae.push(aj);if(at){ao=this.right=new j(this,"right");ae.push(F(ao));var am=R("div",null,"CodeMirror-merge-pane CodeMirror-merge-right");ae.push(am)}(at?am:aj).className+=" CodeMirror-merge-pane-rightmost";ae.push(R("div",null,null,"height: 0; clear: both;"));var af=this.wrap=ah.appendChild(R("div",ae,"CodeMirror-merge CodeMirror-merge-"+al+"pane"));this.edit=y(aj,p(ar));if(ag){ag.init(ad,ak,ar)}if(ao){ao.init(am,ai,ar)}if(ar.collapseIdentical){this.editor().operation(function(){W(aq,ar.collapseIdentical)})}if(ar.connect=="align"){this.aligners=[];f(this.left||this.right,true)}if(ag){ag.registerEvents()}if(ao){ao.registerEvents()}var ac=function(){if(ag){r(ag)}if(ao){r(ao)}};y.on(window,"resize",ac);var ap=setInterval(function(){for(var au=af.parentNode;au&&au!=document.body;au=au.parentNode){}if(!au){clearInterval(ap);y.off(window,"resize",ac)}},5000)};function F(af){var ae=af.lockButton=R("div",null,"CodeMirror-merge-scrolllock");ae.title="Toggle locked scrolling";var ag=R("div",[ae],"CodeMirror-merge-scrolllock-wrap");y.on(ae,"click",function(){v(af,!af.lockScroll)});var ad=[ag];if(af.mv.options.revertButtons!==false){af.copyButtons=R("div",null,"CodeMirror-merge-copybuttons-"+af.type);y.on(af.copyButtons,"click",function(ai){var ah=ai.target||ai.srcElement;if(!ah.chunk){return}if(ah.className=="CodeMirror-merge-copy-reverse"){t(af,af.orig,af.edit,ah.chunk);return}t(af,af.edit,af.orig,ah.chunk)});ad.unshift(af.copyButtons)}if(af.mv.options.connect!="align"){var ac=document.createElementNS&&document.createElementNS(L,"svg");if(ac&&!ac.createSVGRect){ac=null}af.svg=ac;if(ac){ad.push(ac)}}return af.gap=R("div",ad,"CodeMirror-merge-gap")}x.prototype={constructor:x,editor:function(){return this.edit},rightOriginal:function(){return this.right&&this.right.orig},leftOriginal:function(){return this.left&&this.left.orig},setShowDifferences:function(ac){if(this.right){this.right.setShowDifferences(ac)}if(this.left){this.left.setShowDifferences(ac)}},rightChunks:function(){if(this.right){M(this.right);return this.right.chunks}},leftChunks:function(){if(this.left){M(this.left);return this.left.chunks}}};function G(ac){if(typeof ac=="string"){return ac}else{return ac.getValue()}}var J=new diff_match_patch();function b(ad,ac){var ag=J.diff_main(ad,ac);for(var af=0;af<ag.length;++af){var ae=ag[af];if(!ae[1]){ag.splice(af--,1)}else{if(af&&ag[af-1][0]==ae[0]){ag.splice(af--,1);ag[af][1]+=ae[1]}}}return ag}function s(ap){var ah=[];var am=0,al=0;var aq=o(0,0),ao=o(0,0);for(var ae=0;ae<ap.length;++ae){var ad=ap[ae],an=ad[0];if(an==DIFF_EQUAL){var ac=N(ap,ae)?0:1;var ag=aq.line+ac,af=ao.line+ac;I(aq,ad[1],null,ao);var ai=Q(ap,ae)?1:0;var ak=aq.line+ai,aj=ao.line+ai;if(ak>ag){if(ae){ah.push({origFrom:al,origTo:af,editFrom:am,editTo:ag})}am=ak;al=aj}}else{I(an==DIFF_INSERT?aq:ao,ad[1])}}if(am<=aq.line||al<=ao.line){ah.push({origFrom:al,origTo:ao.line+1,editFrom:am,editTo:aq.line+1})}return ah}function Q(ae,ac){if(ac==ae.length-1){return true}var ad=ae[ac+1][1];if((ad.length==1&&ac<ae.length-2)||ad.charCodeAt(0)!=10){return false}if(ac==ae.length-2){return true}ad=ae[ac+2][1];return(ad.length>1||ac==ae.length-3)&&ad.charCodeAt(0)==10}function N(ae,ac){if(ac==0){return true}var ad=ae[ac-1][1];if(ad.charCodeAt(ad.length-1)!=10){return false}if(ac==1){return true}ad=ae[ac-2][1];return ad.charCodeAt(ad.length-1)==10}function aa(ag,ac,ai){var ak,am,ae,ah;for(var ad=0;ad<ag.length;ad++){var aj=ag[ad];var al=ai?aj.editFrom:aj.origFrom;var af=ai?aj.editTo:aj.origTo;if(am==null){if(al>ac){am=aj.editFrom;ah=aj.origFrom}else{if(af>ac){am=aj.editTo;ah=aj.origTo}}}if(af<=ac){ak=aj.editTo;ae=aj.origTo}else{if(al<=ac){ak=aj.editFrom;ae=aj.origFrom}}}return{edit:{before:ak,after:am},orig:{before:ae,after:ah}}}function B(ad,ah,ag){ad.addLineClass(ah,"wrap","CodeMirror-merge-collapsed-line");var ae=document.createElement("span");ae.className="CodeMirror-merge-collapsed-widget";ae.title="Identical text collapsed. Click to expand.";var af=ad.markText(o(ah,0),o(ag-1),{inclusiveLeft:true,inclusiveRight:true,replacedWith:ae,clearOnEnter:true});function ac(){af.clear();ad.removeLineClass(ah,"wrap","CodeMirror-merge-collapsed-line")}y.on(ae,"click",ac);return{mark:af,clear:ac}}function w(ae,ah){var ag=[];function ac(){for(var aj=0;aj<ag.length;aj++){ag[aj].clear()}}for(var ad=0;ad<ah.length;ad++){var af=ah[ad];var ai=B(af.cm,af.line,af.line+ae);ag.push(ai);ai.mark.on("clear",ac)}return ag[0].mark}function z(ag,ah,ai,ac){for(var af=0;af<ag.chunks.length;af++){var ae=ag.chunks[af];for(var ad=ae.editFrom-ah;ad<ae.editTo+ah;ad++){var aj=ad+ai;if(aj>=0&&aj<ac.length){ac[aj]=false}}}}function W(al,af){if(typeof af!="number"){af=2}var ah=[],ak=al.editor(),ac=ak.firstLine();for(var ad=ac,ai=ak.lastLine();ad<=ai;ad++){ah.push(true)}if(al.left){z(al.left,af,ac,ah)}if(al.right){z(al.right,af,ac,ah)}for(var ag=0;ag<ah.length;ag++){if(ah[ag]){var an=ag+ac;for(var am=1;ag<ah.length-1&&ah[ag+1];ag++,am++){}if(am>af){var aj=[{line:an,cm:ak}];if(al.left){aj.push({line:E(an,al.left.chunks),cm:al.left.orig})}if(al.right){aj.push({line:E(an,al.right.chunks),cm:al.right.orig})}var ae=w(am,aj);if(al.options.onCollapse){al.options.onCollapse(al,an,am,ae)}}}}}function R(ac,ag,af,ae){var ah=document.createElement(ac);if(af){ah.className=af}if(ae){ah.style.cssText=ae}if(typeof ag=="string"){ah.appendChild(document.createTextNode(ag))}else{if(ag){for(var ad=0;ad<ag.length;++ad){ah.appendChild(ag[ad])}}}return ah}function K(ad){for(var ac=ad.childNodes.length;ac>0;--ac){ad.removeChild(ad.firstChild)}}function i(ac){for(var ad=1;ad<arguments.length;ad+=2){ac.setAttribute(arguments[ad],arguments[ad+1])}}function p(ad,ac){if(!ac){ac={}}for(var ae in ad){if(ad.hasOwnProperty(ae)){ac[ae]=ad[ae]}}return ac}function I(ai,ag,ah,ad){var af=ah?o(ai.line,ai.ch):ai,ac=0;for(;;){var ae=ag.indexOf("\n",ac);if(ae==-1){break}++af.line;if(ad){++ad.line}ac=ae+1}af.ch=(ac?0:af.ch)+(ag.length-ac);if(ad){ad.ch=(ac?0:ad.ch)+(ag.length-ac)}return af}var Y=1,g=2,k=4;function C(ac){this.cm=ac;this.alignable=[];var ad=this;ac.on("markerAdded",function(af,ae){if(!ae.collapsed){return}var ag=ae.find(1);if(ag!=null){ad.set(ag.line,k)}});ac.on("markerCleared",function(ag,af,ah,ae){if(ae!=null&&af.collapsed){ad.check(ae,k,ad.hasMarker)}});ac.on("markerChanged",this.signal.bind(this));ac.on("lineWidgetAdded",function(ae,af,ag){if(af.mergeSpacer){return}if(af.above){ad.set(ag-1,g)}else{ad.set(ag,Y)}});ac.on("lineWidgetCleared",function(ae,af,ag){if(af.mergeSpacer){return}if(af.above){ad.check(ag-1,g,ad.hasWidgetBelow)}else{ad.check(ag,Y,ad.hasWidget)}});ac.on("lineWidgetChanged",this.signal.bind(this));ac.on("change",function(af,aj){var ai=aj.from.line,ah=aj.to.line-aj.from.line;var ag=aj.text.length-1,ae=ai+ag;if(ah||ag){ad.map(ai,ah,ag)}ad.check(ae,k,ad.hasMarker);if(ah||ag){ad.check(aj.from.line,k,ad.hasMarker)}})}C.prototype={signal:function(){y.signal(this,"realign")},set:function(af,ac){var ae=-1;for(;ae<this.alignable.length;ae+=2){var ad=this.alignable[ae]-af;if(ad==0){if((this.alignable[ae+1]&ac)==ac){return}this.alignable[ae+1]|=ac;this.signal();return}if(ad>0){break}}this.signal();this.alignable.splice(ae,0,af,ac)},find:function(ad){for(var ac=0;ac<this.alignable.length;ac+=2){if(this.alignable[ac]==ad){return ac}}return -1},check:function(ag,ad,ae){var af=this.find(ag);if(af==-1||!(this.alignable[af+1]&ad)){return}if(!ae.call(this,ag)){this.signal();var ac=this.alignable[af+1]&~ad;if(ac){this.alignable[af+1]=ac}else{this.alignable.splice(af,2)}}},hasMarker:function(ae){var ad=this.cm.getLineHandle(ae);if(ad.markedSpans){for(var ac=0;ac<ad.markedSpans.length;ac++){if(ad.markedSpans[ac].mark.collapsed&&ad.markedSpans[ac].to!=null){return true}}}return false},hasWidget:function(ae){var ad=this.cm.getLineHandle(ae);if(ad.widgets){for(var ac=0;ac<ad.widgets.length;ac++){if(!ad.widgets[ac].above&&!ad.widgets[ac].mergeSpacer){return true}}}return false},hasWidgetBelow:function(ae){if(ae==this.cm.lastLine()){return false}var ad=this.cm.getLineHandle(ae+1);if(ad.widgets){for(var ac=0;ac<ad.widgets.length;ac++){if(ad.widgets[ac].above&&!ad.widgets[ac].mergeSpacer){return true}}}return false},map:function(aj,ah,ai){var al=ai-ah,ak=aj+ah,af=-1,ac=-1;for(var ag=0;ag<this.alignable.length;ag+=2){var ae=this.alignable[ag];if(ae==aj&&(this.alignable[ag+1]&g)){af=ag}if(ae==ak&&(this.alignable[ag+1]&g)){ac=ag}if(ae<=aj){continue}else{if(ae<ak){this.alignable.splice(ag--,2)}else{this.alignable[ag]+=al}}}if(af>-1){var ad=this.alignable[af+1];if(ad==g){this.alignable.splice(af,2)}else{this.alignable[af+1]=ad&~g}}if(ac>-1&&ai){this.set(aj+ai,g)}}};function l(ad,ac){return(ad.line-ac.line||ad.ch-ac.ch)<0?ad:ac}function O(ad,ac){return(ad.line-ac.line||ad.ch-ac.ch)>0?ad:ac}function T(ad,ac){return ad.line==ac.line&&ad.ch==ac.ch}function c(ah,ag,ac){for(var ae=ah.length-1;ae>=0;ae--){var ad=ah[ae];var af=(ac?ad.origTo:ad.editTo)-1;if(af<ag){return af}}}function h(ah,ag,ac){for(var ae=0;ae<ah.length;ae++){var ad=ah[ae];var af=(ac?ad.origFrom:ad.editFrom);if(af>ag){return af}}}function X(ah,ad){var aj=null,ai=ah.state.diffViews,ak=ah.getCursor().line;if(ai){for(var af=0;af<ai.length;af++){var ac=ai[af],ae=ah==ac.orig;M(ac);var ag=ad<0?c(ac.chunks,ak,ae):h(ac.chunks,ak,ae);if(ag!=null&&(aj==null||(ad<0?ag>aj:ag<aj))){aj=ag}}}if(aj!=null){ah.setCursor(aj,0)}else{return y.Pass}}y.commands.goNextDiff=function(ac){return X(ac,1)};y.commands.goPrevDiff=function(ac){return X(ac,-1)}});