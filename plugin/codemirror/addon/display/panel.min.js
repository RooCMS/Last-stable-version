(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(a){a.defineExtension("addPanel",function(h,g){g=g||{};if(!this.state.panels){b(this)}var i=this.state.panels;var k=i.wrapper;var j=this.getWrapperElement();if(g.after instanceof d&&!g.after.cleared){k.insertBefore(h,g.before.node.nextSibling)}else{if(g.before instanceof d&&!g.before.cleared){k.insertBefore(h,g.before.node)}else{if(g.replace instanceof d&&!g.replace.cleared){k.insertBefore(h,g.replace.node);g.replace.clear()}else{if(g.position=="bottom"){k.appendChild(h)}else{if(g.position=="before-bottom"){k.insertBefore(h,j.nextSibling)}else{if(g.position=="after-top"){k.insertBefore(h,j)}else{k.insertBefore(h,k.firstChild)}}}}}}var f=(g&&g.height)||h.offsetHeight;this._setSize(null,i.heightLeft-=f);i.panels++;if(g.stable&&e(this,h)){this.scrollTo(null,this.getScrollInfo().top+f)}return new d(this,h,g,f)});function d(g,i,h,f){this.cm=g;this.node=i;this.options=h;this.height=f;this.cleared=false}d.prototype.clear=function(){if(this.cleared){return}this.cleared=true;var f=this.cm.state.panels;this.cm._setSize(null,f.heightLeft+=this.height);if(this.options.stable&&e(this.cm,this.node)){this.cm.scrollTo(null,this.cm.getScrollInfo().top-this.height)}f.wrapper.removeChild(this.node);if(--f.panels==0){c(this.cm)}};d.prototype.changed=function(f){var g=f==null?this.node.offsetHeight:f;var h=this.cm.state.panels;this.cm._setSize(null,h.height+=(g-this.height));this.height=g};function b(g){var i=g.getWrapperElement();var h=window.getComputedStyle?window.getComputedStyle(i):i.currentStyle;var f=parseInt(h.height);var j=g.state.panels={setHeight:i.style.height,heightLeft:f,panels:0,wrapper:document.createElement("div")};i.parentNode.insertBefore(j.wrapper,i);var k=g.hasFocus();j.wrapper.appendChild(i);if(k){g.focus()}g._setSize=g.setSize;if(f!=null){g.setSize=function(n,l){if(l==null){return this._setSize(n,l)}j.setHeight=l;if(typeof l!="number"){var m=/^(\d+\.?\d*)px$/.exec(l);if(m){l=Number(m[1])}else{j.wrapper.style.height=l;l=j.wrapper.offsetHeight;j.wrapper.style.height=""}}g._setSize(n,j.heightLeft+=(l-f));f=l}}}function c(f){var h=f.state.panels;f.state.panels=null;var g=f.getWrapperElement();h.wrapper.parentNode.replaceChild(g,h.wrapper);g.style.height=h.setHeight;f.setSize=f._setSize;f.setSize()}function e(f,h){for(var g=h.nextSibling;g;g=g.nextSibling){if(g==f.getWrapperElement()){return true}}return false}});