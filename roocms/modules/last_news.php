<?php/*=========================================================|	This script was developed by alex Roosso .|	Title: RooCMS module Last News|	Author:	alex Roosso|	Copyright: 2010-2011 (c) RooCMS. |	Web: http://www.roocms.com|	All rights reserved.|----------------------------------------------------------|	This program is free software; you can redistribute it and/or modify|	it under the terms of the GNU General Public License as published by|	the Free Software Foundation; either version 2 of the License, or|	(at your option) any later version.|	|	Данное программное обеспечение является свободным и распространяется|	по лицензии Фонда Свободного ПО - GNU General Public License версия 2.|	При любом использовании данного ПО вы должны соблюдать все условия|	лицензии.|----------------------------------------------------------|	Build date: 		7:00 04.03.2011|	Last build: 		4:04 20.10.2011|	Version file:		1.00 build 3=========================================================*///#########################################################// Anti Hack//---------------------------------------------------------if(!defined('RooCMS')) die('Access Denied');//#########################################################require_once _CMS."/functions_news.php";// Load template$module['last_news'] = $tpl->load_template("module_last_news", true);function RunModuleLastNews() {		global $db, $config, $tpl, $html, $parse;	if($config->lastnews_limit <= 0) $config->lastnews_limit = 2;		// query	$q = $db->query("SELECT n.id, n.category_id, n.date, n.title, n.brief_news, c.name AS catname						FROM ".NEWS_ITEM." AS n						LEFT JOIN ".NEWS_CATEGORY." AS c ON (c.id = n.category_id)						WHERE n.date <= '".time()."' 						ORDER BY n.date DESC, n.id DESC						LIMIT ".$config->lastnews_limit);	while($news = $db->fetch_assoc($q)) {		// parse		$news['brief_news'] = $parse->text->html($news['brief_news']);		$news['rdate']		= $parse->date->unix_to_rus($news['date']);				// cut		$cut = explode(". ",$news['brief_news']);		if(mb_strlen($cut[0], 'utf8') < 60 && isset($cut[1])) $news['text'] = $cut[0]." ".$cut[1]." ";		else $news['text'] = $cut[0]." ";		// query image		$im = $db->query("SELECT thumb_img FROM ".NEWS_IMAGE." WHERE news_id='".$news['id']."' ORDER BY id ASC LIMIT 1");		$image = $db->fetch_assoc($im);		if($image) $news['image_news'] = $image['thumb_img'];				// output		$html['last_news'][] = $tpl->tpl->last_news($news);	}}RunModuleLastNews();?>